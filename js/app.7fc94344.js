(function(t){function e(e){for(var i,a,s=e[0],c=e[1],l=e[2],d=0,p=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(p.length)p.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(i=!1)}i&&(r.splice(e--,1),t=a(a.s=n[0]))}return t}var i={},o={app:0},r=[];function a(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=i,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var i=n("8a23"),o=n.n(i);o.a},1417:function(t,e,n){},"1f19":function(t,e,n){"use strict";var i=n("3ce4"),o=n.n(i);o.a},"26f3":function(t,e,n){},"3c45":function(t,e,n){"use strict";var i=n("26f3"),o=n.n(i);o.a},"3ce4":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",{attrs:{id:"app"}},[n("transition",{attrs:{name:"fade",mode:"out-in"}},[t.setup?n("Setup",{on:{setLocation:t.setLocation}}):!t.setup&&t.conditions?n("div",{key:"weather-pane"},[n("CurrentConditions",{attrs:{conditions:t.conditions.current}}),n("PrecipitationGraph",{attrs:{precip:t.conditions.minutely}}),n("Map",{attrs:{lat:t.location.lat,lon:t.location.lon}})],1):t._e()],1),t.ready?n("transition",{attrs:{name:"fade",mode:"out-in"}},[t.setup?n("v-btn",{key:"btn-cancel-setup",attrs:{fab:"",fixed:"",top:"",right:"",icon:"",color:"error"},on:{click:function(e){t.setup=!1}}},[n("v-icon",[t._v("mdi-close")])],1):n("v-btn",{key:"btn-setup",attrs:{fab:"",fixed:"",top:"",right:"",icon:""},on:{click:function(e){t.setup=!0}}},[n("v-icon",{attrs:{color:"#444"}},[t._v("mdi-cog")])],1)],1):t._e()],1)},r=[],a=(n("99af"),n("d3b7"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"map"}})}),s=[],c=(n("d81d"),{name:"Map",props:["lon","lat"],data:function(){return{map:null}},mounted:function(){var t=this;console.log("creating map");var e=this;fetch("https://api.rainviewer.com/public/maps.json").then((function(t){return t.json()})).then((function(n){var i=n[n.length-1];e.map=L.map("map",{attributionControl:!0,zoomControl:!1}).setView([t.lat,t.lon],10),L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png",{attribution:"Carto (CC BY 3.0), OpenStreetMap (ODbL)"}).addTo(e.map);var o=L.tileLayer("https://tilecache.rainviewer.com/v2/radar/".concat(i,"/512/{z}/{x}/{y}/8/1_1.png"),{attribution:"RainViewer"}).setOpacity(.75).addTo(e.map);window.setInterval((function(){o.redraw()}),3e5)}))},watch:{lat:function(){this.map.setView([this.lat,this.lon],10)},lon:function(){this.map.setView([this.lat,this.lon],10)}}}),l=c,u=(n("1f19"),n("2877")),d=Object(u["a"])(l,a,s,!1,null,null,null),p=d.exports,m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"current-conditions"}},[n("table",[n("tr",[n("td",[n("div",{attrs:{id:"main-conditions"}},[n("Measure",{attrs:{id:"current-temperature",condition:t.conditions.temp,inputUnit:"tempK",type:"temperature",measurements:t.measurements}}),n("ConditionIcon",{attrs:{id:"current-condition-icon",condition:t.conditions}})],1)]),n("td",[n("table",{attrs:{id:"detail-conditions"}},[n("tr",[n("td",[n("v-icon",[t._v("mdi-weather-windy")])],1),n("td",[n("Measure",{attrs:{condition:t.conditions.wind_speed,inputUnit:"m/s",type:"speed",measurements:t.measurements}})],1),n("td",[n("v-icon",[t._v("mdi-water-outline")])],1),n("td",[n("span",[t._v(t._s(t.conditions.humidity)+"%")])])]),n("tr",[n("td",[n("v-icon",[t._v("mdi-cloud-outline")])],1),n("td",[n("span",[t._v(t._s(t.conditions.clouds)+"%")])]),n("td",[n("v-icon",[t._v("mdi-eye-outline")])],1),n("td",[n("Measure",{attrs:{condition:t.conditions.visibility,inputUnit:"m",type:"distance",measurements:t.measurements}})],1)]),n("tr",[n("td",[n("v-icon",[t._v("mdi-speedometer")])],1),n("td",[n("span",[t._v(t._s((t.conditions.pressure/1e3).toFixed(2))+" bar")])]),n("td",[n("v-icon",[t._v("mdi-weather-"+t._s(t.nextSolarEvent.type))])],1),n("td",[n("span",[t._v(t._s(t.nextSolarEvent.time))])])])])])])])])},f=[],h=(n("25f0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-icon",{staticClass:"condition-icon",attrs:{dark:!0}},[t._v(t._s(t.CONDITION_CONVERSIONS[t.condition.weather[0].icon]))])}),v=[],g={name:"ConditionIcon",props:["condition"],data:function(){return{CONDITION_CONVERSIONS:{"01d":"mdi-weather-sunny","01n":"mdi-weather-night","02d":"mdi-weather-partly-cloudy","02n":"mdi-weather-night-partly-cloudy","03d":"mdi-weather-cloudy","03n":"mdi-weather-cloudy","04d":"mdi-weather-cloudy","04n":"mdi-weather-cloudy","09d":"mdi-weather-pouring","09n":"mdi-weather-pouring","10d":"mdi-weather-pouring","10n":"mdi-weather-pouring","11d":"mdi-weather-lightning","11n":"mdi-weather-lightning","13d":"mdi-weather-snowy-heavy","13n":"mdi-weather-snowy-heavy","50d":"mdi-weather-fog","50n":"mdi-weather-fog"}}}},w=g,y=(n("3c45"),n("6544")),b=n.n(y),_=n("132d"),x=Object(u["a"])(w,h,v,!1,null,null,null),S=x.exports;b()(x,{VIcon:_["a"]});var I=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[t._v(t._s(t.displayed))])},O=[],k=(n("ac1f"),n("1276"),{name:"Measure",props:["condition","inputUnit","type","measurements"],computed:{displayed:function(){var t=new Qty(this.condition,this.inputUnit);return t.to(this.$units[this.measurements][this.type].unit).toPrec(1).toString().split(" ")[0]+this.$units[this.measurements][this.type].postfix}}}),C=k,M=Object(u["a"])(C,I,O,!1,null,null,null),$=M.exports;function j(t){var e="24"===localStorage.getItem("timefmt"),n=(t.getHours()%12==0?12:t.getHours()%12).toString(),i=(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()).toString(),o=t.getHours()>=12?" pm":" am";return(e?t.getHours():n)+":"+i+(e?"":o)}var V={name:"CurrentConditions",props:["conditions"],components:{ConditionIcon:S,Measure:$},computed:{measurements:function(){return window.localStorage.getItem("measurements")},twentyfourhour:function(){return window.localStorage.getItem("twentyfourhour")},nextSolarEvent:function(){var t=new Date(1e3*this.conditions.sunset),e=new Date(1e3*this.conditions.sunset),n=Date();return n<t?{type:"sunset-up",time:j(t)}:{type:"sunset-down",time:j(e)}}}},T=V,E=(n("f7e7"),Object(u["a"])(T,m,f,!1,null,null,null)),P=E.exports;b()(E,{VIcon:_["a"]});var N=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"setup-pane"}},[n("v-icon",[t._v("mdi-api")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.key,expression:"key"}],staticClass:"ap-input",attrs:{id:"owm-key",placeholder:"OpenWeatherMap API Key"},domProps:{value:t.key},on:{input:function(e){e.target.composing||(t.key=e.target.value)}}}),n("v-expand-transition",[t.key?n("div",[n("br"),n("br"),n("br"),n("v-icon",[t._v("mdi-weight")]),n("v-select",{attrs:{block:"",label:"Units",items:[{value:"imperial",text:"Imperial"},{value:"metric",text:"Metric"}]},model:{value:t.units,callback:function(e){t.units=e},expression:"units"}}),n("v-select",{attrs:{block:"",label:"Time Format",items:[{value:"12",text:"12 Hour ("+t.parseDate(new Date,!1)+")"},{value:"24",text:"24 Hour ("+t.parseDate(new Date,!0)+")"}]},model:{value:t.timefmt,callback:function(e){t.timefmt=e},expression:"timefmt"}}),n("br"),n("br"),n("br"),n("v-icon",[t._v("mdi-map-marker")]),n("LocationField",t._g({},t.$listeners)),n("p",{attrs:{id:"setup-separator"}},[t._v("OR")]),n("Geolocator",t._g({},t.$listeners))],1):t._e()])],1)},D=[],F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("input",{attrs:{id:"location-field",placeholder:"Enter a city..."}})},H=[],z=(n("b0c0"),{name:"LocationField",mounted:function(){var t=this,e=places({container:document.querySelector("#location-field"),templates:{value:function(t){return t.name}}}).configure({type:"city",aroundLatLngViaIP:!0});window.setTimeout((function(){document.querySelector("#location-field").focus()}),10),e.on("change",(function(e){var n=e.suggestion.latlng;t.$emit("setLocation",{lat:n.lat,lon:n.lng})}))}}),R=z,A=(n("d599"),Object(u["a"])(R,F,H,!1,null,null,null)),G=A.exports,J=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-btn",{attrs:{block:"",color:"primary",outlined:""},on:{click:t.geolocate}},[n("v-icon",[t._v("mdi-navigation")]),t._v("Find Me")],1)},K=[],U={name:"Geolocator",methods:{geolocate:function(){var t=this;navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){console.log(e),t.$emit("setLocation",{lat:e.coords.latitude,lon:e.coords.longitude})})):console.log("not supported")}}},q=U,B=(n("57d4"),n("8336")),W=Object(u["a"])(q,J,K,!1,null,"0c28b26b",null),Q=W.exports;b()(W,{VBtn:B["a"],VIcon:_["a"]});var Y={name:"Setup",components:{LocationField:G,Geolocator:Q},mounted:function(){document.querySelector("#owm-key").focus(),localStorage.setItem("measurements",this.units),localStorage.setItem("timefmt",this.timefmt)},data:function(){return{key:localStorage.getItem("owmKey")||"",units:localStorage.getItem("measurements")||"imperial",timefmt:localStorage.getItem("timefmt")||"12"}},methods:{parseDate:function(t,e){var n=(t.getHours()%12==0?12:t.getHours()%12).toString(),i=(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()).toString(),o=t.getHours()>=12?" pm":" am";return(e?t.getHours():n)+":"+i+(e?"":o)}},watch:{key:function(){localStorage.setItem("owmKey",this.key)},units:function(){localStorage.setItem("measurements",this.units)},timefmt:function(){localStorage.setItem("timefmt",this.timefmt)}}},X=Y,Z=(n("9596"),n("0789")),tt=n("b974"),et=Object(u["a"])(X,N,D,!1,null,null,null),nt=et.exports;b()(et,{VExpandTransition:Z["a"],VIcon:_["a"],VSelect:tt["a"]});var it=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-expand-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],attrs:{id:"precip-graph-container"}},[n("canvas",{ref:"cnv",on:{resize:t.resize}})])])},ot=[];n("cb29"),n("4de4");function rt(t,e,n){var i;return function(){var o=this,r=arguments,a=function(){i=null,n||t.apply(o,r)},s=n&&!i;clearTimeout(i),i=setTimeout(a,e),s&&t.apply(o,r)}}function at(t){var e=0;return t>.1&&(e=1),t>10&&(e=2),t>20&&(e=3),e}var st={name:"PrecipitationGraph",props:["precip"],data:function(){return{ctx:null,t:0,offsets:[],visible:!1}},created:function(){this.computeVisible()},mounted:function(){var t=this;console.log("mounted"),this.ctx=this.$refs.cnv.getContext("2d"),this.resize();for(var e=0;e<=60;e++)this.offsets.push(6*e);window.requestAnimationFrame(this.render),window.addEventListener("resize",rt((function(){t.resize(),console.log("resized")}),100))},methods:{render:function(){if(this.visible){this.t+=1,this.t%=360;var t=this.$refs.cnv,e=this.ctx;if(!this.$refs.cnv)return console.log("canvas does not exist");e.clearRect(0,0,t.width,t.height),e.font="10px Roboto",e.beginPath(),e.moveTo(0,t.height),e.fillStyle="#4FC3F7";for(var n=Math.round(((new Date).getTime()/1e3-this.precip[0].dt)/60),i=0;i<=50;i++){for(var o=0,r=0,a=-2;a<=2;a++)i+a+n>=0&&i+a+n<=60&&(o+=at(this.precip[(i+a+n).toString()].precipitation),r++);var s=0==r?0:o/r;e.lineTo(Math.floor(t.width*i*.02),t.height-(t.height*(s/3)+Math.sin(4*(this.offsets[i]+this.t)*2*Math.PI/360)*s*(t.height/40)))}e.lineTo(t.width,t.height),e.closePath(),e.fill(),e.fillStyle="#ffffff",e.textAlign="left",e.textBaseline="middle";for(var c=["high","medium","low",""],l=0;l<=3;l++)l>0&&l<3&&e.fillRect(0,Math.floor(.99*t.height*(l/3)),4,1),e.fillText(c[l],2,Math.floor(t.height*((l+.5)/3)));e.textBaseline="bottom",e.textAlign="center";for(var u=1;u<5;u++)e.fillRect(Math.round(t.width*(u/5)),t.height-4,1,4),e.fillText(10*u+" min",Math.round(t.width*(u/5)),t.height-4);window.requestAnimationFrame(this.render)}},resize:function(){this.$refs.cnv&&(this.$refs.cnv.width=this.$refs.cnv.offsetWidth,this.$refs.cnv.height=this.$refs.cnv.offsetHeight)},computeVisible:function(){var t=this.visible;this.visible=this.precip.filter((function(t){return t.precipitation>=.1})).length>0,this.visible&&!t&&this.render()}},watch:{precip:function(){this.computeVisible()}}},ct=st,lt=(n("cc98"),Object(u["a"])(ct,it,ot,!1,null,"38bb645f",null)),ut=lt.exports;b()(lt,{VExpandTransition:Z["a"]});var dt={name:"App",components:{Map:p,CurrentConditions:P,Setup:nt,PrecipitationGraph:ut},data:function(){return{conditions:null,location:null,setup:!1,ready:!1}},created:function(){window.setInterval(this.refresh,1e4);var t=localStorage.getItem("location"),e=localStorage.getItem("owmKey"),n=localStorage.getItem("measurements");t&&e&&n?(this.location=JSON.parse(t),this.ready=!0,this.refresh()):this.setup=!0},methods:{setLocation:function(t){this.location=t,localStorage.setItem("location",JSON.stringify(t)),localStorage.removeItem("conditionCache"),this.setup=!1,this.ready=!0,this.refresh()},getConditions:function(t,e){var n=this,i=localStorage.getItem("conditionCache");if(i){i=JSON.parse(i);var o=i.current.dt,r=(new Date).getTime()/1e3-o;console.log(r),r>600?n.fetchConditions(t,(function(t){e(t)})):(console.log("using cached conditions"),e(i))}else n.fetchConditions(t,(function(t){e(t)}))},fetchConditions:function(t,e){console.log(this.$refs),fetch("https://api.openweathermap.org/data/2.5/onecall?lat=".concat(t.lat,"&lon=").concat(t.lon,"&exclude=daily&appid=").concat(localStorage.getItem("owmKey"))).then((function(t){return t.json()})).then((function(t){e(t),localStorage.setItem("conditionCache",JSON.stringify(t))}))},refresh:function(){var t=this;t.location&&t.getConditions(t.location,(function(e){t.conditions=e}))}}},pt=dt,mt=(n("034f"),n("7496")),ft=Object(u["a"])(pt,o,r,!1,null,null,null),ht=ft.exports;b()(ft,{VApp:mt["a"],VBtn:B["a"],VIcon:_["a"]});var vt=n("f309");i["a"].use(vt["a"]);var gt=new vt["a"]({theme:{dark:!0}}),wt={temperature:{unit:"tempC",postfix:"°"},speed:{unit:"km/h",postfix:" km/h"},distance:{unit:"km",postfix:" km"}},yt={temperature:{unit:"tempF",postfix:"°"},speed:{unit:"mph",postfix:" mph"},distance:{unit:"mi",postfix:" mi"}};i["a"].config.productionTip=!1,i["a"].prototype.$units={metric:wt,imperial:yt},new i["a"]({vuetify:gt,render:function(t){return t(ht)}}).$mount("#app")},"57d4":function(t,e,n){"use strict";var i=n("1417"),o=n.n(i);o.a},"667d":function(t,e,n){},"84b0":function(t,e,n){},"8a23":function(t,e,n){},"8b8e":function(t,e,n){},"8c6c":function(t,e,n){},9596:function(t,e,n){"use strict";var i=n("8c6c"),o=n.n(i);o.a},cc98:function(t,e,n){"use strict";var i=n("84b0"),o=n.n(i);o.a},d599:function(t,e,n){"use strict";var i=n("8b8e"),o=n.n(i);o.a},f7e7:function(t,e,n){"use strict";var i=n("667d"),o=n.n(i);o.a}});
//# sourceMappingURL=app.7fc94344.js.map